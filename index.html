<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <title>هدیه به رویا</title>
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Vazirmatn', sans-serif;
      background: linear-gradient(to top right, #f8bbd0, #e1bee7);
      color: #4a148c;
      text-align: center;
      padding: 30px;
      direction: rtl;
    }
    .hidden { display: none; }
    h2 { font-size: 2rem; margin-bottom: 10px; }
    .btn {
      font-family: inherit;
      padding: 10px 20px;
      margin: 5px;
      font-size: 18px;
      border: none;
      border-radius: 8px;
      background-color: #7e57c2;
      color: white;
      cursor: pointer;
      transition: 0.3s;
    }
    .btn:hover { background-color: #5e35b1; }
    .gif {
      margin-top: 15px;
      width: 200px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }
    .light-container {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin: 30px 0;
    }
    .light {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      border: 3px solid #fff;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      transition: box-shadow 0.3s;
    }
    #letterChoices button {
      background-color: #fce4ec;
      color: #880e4f;
      font-weight: bold;
    }
    #selectedLetters {
      font-size: 24px;
      margin: 10px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <audio id="music1" src="Music1.mp3" loop></audio>
  <audio id="music2" src="Music2.mp3" loop></audio>

  <!-- Step 1: Name -->
  <div id="step1">
    <h2>نامت را بساز</h2>
    <div id="nameButtons"></div>
    <div id="nameDisplay"></div>
    <button class="btn" onclick="checkBuiltName()">ادامه</button>
    <button class="btn" style="background:#e53935;" onclick="resetName()">پاک کن</button>
    <br>
    <img class="gif" src="https://media.tenor.com/mwzLh4Sr5GkAAAAC/anime-girl-happy.gif" />
  </div>

  <!-- Step 2: Lights Game -->
  <div id="step2" class="hidden">
    <h2>ترتیب روشن شدن چراغ‌ها را بخاطر بسپار</h2>
    <div class="light-container" id="lights"></div>
    <div class="hidden" id="guessArea">
      <p>با کلیک بر چراغ‌ها به ترتیب روشنی را حدس بزن:</p>
      <div class="light-container" id="guessLights"></div>
    </div>
  </div>

  <!-- Step 3: Riddle -->
  <div id="step3" class="hidden">
    <h2>کدام کلید است که هیچ دری را باز نمی‌کند؟</h2>
    <p>حروف را انتخاب کن تا جواب بسازی:</p>
    <div id="letterChoices"></div>
    <div id="selectedLetters"></div>
    <button class="btn" onclick="checkRiddleAnswer()">بررسی</button>
    <button class="btn" style="background:#e53935;" onclick="startRiddle()">پاک کن</button>
    <br>
    <img class="gif" src="https://media.gifdb.com/blue-haired-anime-girl-dancing-2zc3cgush44nid16.gif">
  </div>

  <!-- Step 4: Birthday Final -->
  <div id="step4" class="hidden">
    <h2>تولدت مبارک رویای عزیز! 🎂</h2>
    <img class="gif" src="https://cliply.co/wp-content/uploads/2021/02/392102670_BIRTHDAY_CAKE_400px.gif">
  </div>

  <script>
    const COLORS = ["yellow", "red", "blue", "green", "brown", "orange"];
    const LIGHT_COUNT = 6;
    const SEQUENCE_LENGTH = 5;
    let lights = [], sequence = [], userGuess = [];
    const music1 = document.getElementById("music1");
    const music2 = document.getElementById("music2");

    const nameLetters = ["ر", "و", "ی", "ا"];
    let builtName = [];

    function initNameButtons() {
      const container = document.getElementById("nameButtons");
      container.innerHTML = "";
      builtName = [];
      updateNameDisplay();
      nameLetters.forEach(char => {
        const btn = document.createElement("button");
        btn.textContent = char;
        btn.className = "btn";
        btn.onclick = () => {
          builtName.push(char);
          updateNameDisplay();
        };
        container.appendChild(btn);
      });
    }

    function updateNameDisplay() {
      document.getElementById("nameDisplay").textContent = builtName.join("");
    }

    function resetName() {
      builtName = [];
      updateNameDisplay();
    }

    function checkBuiltName() {
      const name = builtName.join("");
      if (name === "رویا") {
        document.getElementById("step1").classList.add("hidden");
        document.getElementById("step2").classList.remove("hidden");
        startLightGame();
        music1.play();
      } else {
        alert("فقط رویا اجازه دارد وارد شود!");
        resetName();
      }
    }

    function startLightGame() {
      const lightsContainer = document.getElementById("lights");
      const guessLightsContainer = document.getElementById("guessLights");
      const guessArea = document.getElementById("guessArea");

      lightsContainer.innerHTML = "";
      lights = [];
      for (let i = 0; i < LIGHT_COUNT; i++) {
        const light = document.createElement("div");
        light.classList.add("light");
        light.style.backgroundColor = COLORS[i];
        lightsContainer.appendChild(light);
        lights.push(light);
      }

      sequence = [];
      let count = 0;
      const interval = setInterval(() => {
        const index = Math.floor(Math.random() * LIGHT_COUNT);
        sequence.push(index);
        lights[index].style.boxShadow = `0 0 20px 10px ${COLORS[index]}`;
        setTimeout(() => {
          lights[index].style.boxShadow = "none";
        }, 400);
        count++;
        if (count >= SEQUENCE_LENGTH) {
          clearInterval(interval);
          setTimeout(() => {
            guessArea.classList.remove("hidden");
            guessLightsContainer.innerHTML = "";
            userGuess = [];
            for (let i = 0; i < LIGHT_COUNT; i++) {
              const guessLight = document.createElement("div");
              guessLight.classList.add("light");
              guessLight.style.backgroundColor = COLORS[i];
              guessLight.dataset.index = i;
              guessLight.onclick = () => {
                userGuess.push(i);
                guessLight.style.boxShadow = `0 0 20px 10px ${COLORS[i]}`;
                setTimeout(() => {
                  guessLight.style.boxShadow = "none";
                }, 300);
                if (userGuess.length === SEQUENCE_LENGTH) checkLightAnswer();
              };
              guessLightsContainer.appendChild(guessLight);
            }
          }, 500);
        }
      }, 700);
    }

    function checkLightAnswer() {
      for (let i = 0; i < SEQUENCE_LENGTH; i++) {
        if (sequence[i] !== userGuess[i]) {
          alert("اشتباه بود! دوباره تلاش کن");
          document.getElementById("guessArea").classList.add("hidden");
          startLightGame();
          return;
        }
      }
      alert("آفرین درست گفتی!");
      document.getElementById("step2").classList.add("hidden");
      document.getElementById("step3").classList.remove("hidden");
      startRiddle();
    }

    function startRiddle() {
      const letters = "ک ل ی د ب ر ق".split(" ");
      const all = letters.concat(["آ","ت","ن","و","ا","ف","ج","ح","ص"]);
      all.sort(() => Math.random() - 0.5);
      const letterChoices = document.getElementById("letterChoices");
      const selectedLetters = document.getElementById("selectedLetters");
      letterChoices.innerHTML = "";
      selectedLetters.innerHTML = "";
      const answer = [];
      all.forEach(char => {
        const btn = document.createElement("button");
        btn.textContent = char;
        btn.onclick = () => {
          answer.push(char);
          selectedLetters.textContent = answer.join("");
        };
        letterChoices.appendChild(btn);
      });
      window.checkRiddleAnswer = function() {
        if (answer.join("") === "کلیدبرق") {
          alert("آفرین! جواب درست بود");
          document.getElementById("step3").classList.add("hidden");
          document.getElementById("step4").classList.remove("hidden");
          music1.pause();
          music2.play();
        } else {
          alert("اشتباه بود! دوباره امتحان کن");
          startRiddle();
        }
      }
    }

    window.onload = initNameButtons;
  </script>
</body>
</html>
